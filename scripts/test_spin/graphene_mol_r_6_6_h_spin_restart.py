###### capture the output ##########
import sys
old_stdout = sys.stdout
log_file = open("graphene_mol_r_6_6_h_spin.out","w")
sys.stdout = log_file
###### capture the output ##########

import json
from pyscf import gto, dft
from pyscf.geomopt.geometric_solver import optimize
#
#

structure_n = 'spin'

N_index = [18,59]
    
coords = [[-7.278387, 4.980656, 0.000000],
    [-7.301837, 0.683897, 0.000000],
    [-6.123049, 2.858203, 0.000000],
    [-4.869897, 4.967519, -0.000000],
    [-7.306918, -3.588906, 0.000000],
    [-6.111325, -1.411833, 0.000000],
    [-4.891250, 0.707961, -0.000000],
    [-3.664419, 2.827407, -0.000000],
    [-2.434859, 4.946565, -0.000000],
    [-6.092642, -5.667044, 0.000000],
    [-4.890016, -3.542707, 0.000000],
    [-3.649354, -1.410570, -0.000000],
    [-2.435428, 0.709439, -0.000000],
    [-1.213670, 2.805635, -0.000000],
    [0.001128, 4.949682, -0.000000],
    [-3.647028, -5.631686, 0.000000],
    [-2.443607, -3.511019, -0.000000],
    [-1.210444, -1.392702, -0.000000],
    [0.003616, 0.702037, -0.000000],
    [1.209790, 2.805282, -0.000000],
    [2.430428, 4.945364, -0.000000],
    [-1.218446, -5.621408, -0.000000],
    [-0.002406, -3.519332, -0.000000],
    [1.217558, -1.392392, -0.000000],
    [2.442007, 0.709464, -0.000000],
    [3.665977, 2.831480, -0.000000],
    [4.870328, 4.968878, 0.000000],
    [1.217770, -5.625343, -0.000000],
    [2.441620, -3.510144, -0.000000],
    [3.652341, -1.414669, -0.000000],
    [4.892764, 0.708766, 0.000000],
    [6.127667, 2.863385, 0.000000],
    [7.277169, 4.989581, 0.000000],
    [3.644286, -5.627850, -0.000000],
    [4.892524, -3.544068, 0.000000],
    [6.111382, -1.416588, 0.000000],
    [7.298358, 0.683583, 0.000000],
    [6.090001, -5.673625, 0.000000],
    [7.309317, -3.597789, 0.000000],
    [-7.306920, 3.588904, 0.000000],
    [-6.092644, 5.667042, 0.000000],
    [-7.301837, -0.683899, 0.000000],
    [-6.111325, 1.411832, 0.000000],
    [-4.890016, 3.542707, -0.000000],
    [-3.647028, 5.631686, -0.000000],
    [-7.278386, -4.980658, 0.000000],
    [-6.123048, -2.858203, 0.000000],
    [-4.891250, -0.707961, -0.000000],
    [-3.649354, 1.410571, -0.000000],
    [-2.443607, 3.511021, -0.000000],
    [-1.218445, 5.621408, -0.000000],
    [-4.869897, -4.967519, 0.000000],
    [-3.664419, -2.827406, -0.000000],
    [-2.435428, -0.709437, -0.000000],
    [-1.210444, 1.392704, -0.000000],
    [-0.002406, 3.519334, -0.000000],
    [1.217771, 5.625344, -0.000000],
    [-2.434859, -4.946563, -0.000000],
    [-1.213670, -2.805633, -0.000000],
    [0.003616, -0.702035, -0.000000],
    [1.217558, 1.392394, -0.000000],
    [2.441620, 3.510146, -0.000000],
    [3.644287, 5.627850, 0.000000],
    [0.001127, -4.949680, -0.000000],
    [1.209790, -2.805280, -0.000000],
    [2.442007, -0.709462, -0.000000],
    [3.652341, 1.414670, -0.000000],
    [4.892525, 3.544068, 0.000000],
    [6.090003, 5.673623, 0.000000],
    [2.430427, -4.945363, -0.000000],
    [3.665976, -2.831479, -0.000000],
    [4.892765, -0.708765, 0.000000],
    [6.111382, 1.416588, 0.000000],
    [7.309318, 3.597787, 0.000000],
    [4.870327, -4.968878, 0.000000],
    [6.127666, -2.863385, 0.000000],
    [7.298358, -0.683584, 0.000000],
    [7.277168, -4.989583, 0.000000],
    [8.212105, 5.536234, 0.000000],
    [8.268254, 3.100326, 0.000000],
    [8.250101, 1.194442, 0.000000],
    [8.250102, -1.194443, 0.000000],
    [8.268252, -3.100327, 0.000000],
    [8.212103, -5.536236, 0.000000],
    [-8.214577, 5.525157, 0.000000],
    [-8.264434, 3.088712, 0.000000],
    [-8.252448, 1.196860, 0.000000],
    [-8.252448, -1.196861, 0.000000],
    [-8.264433, -3.088715, 0.000000],
    [-8.214575, -5.525160, 0.000000],
    [-6.076473, 6.750146, 0.000000],
    [-3.636021, 6.715259, -0.000000],
    [-1.220113, 6.704614, -0.000000],
    [1.220007, 6.708548, -0.000000],
    [3.632130, 6.711411, 0.000000],
    [6.070420, 6.756671, 0.000000],
    [-6.076471, -6.750148, 0.000000],
    [-3.636020, -6.715260, 0.000000],
    [-1.220113, -6.704613, -0.000000],
    [1.220006, -6.708548, -0.000000],
    [3.632128, -6.711411, -0.000000],
    [6.070418, -6.756673, 0.000000]]


species = ['C', 'C', 'C', 'C', 'C', 'C', 'C', 'C', 'C', 'C', 'C', 'C', 
           'C', 'C', 'C', 'C', 'C', 'C', 'C', 'C', 'C', 'C', 'C', 'C', 
           'C', 'C', 'C', 'C', 'C', 'C', 'C', 'C', 'C', 'C', 'C', 'C', 
           'C', 'C', 'C', 'C', 'C', 'C', 'C', 'C', 'C', 'C', 'C', 'C', 
           'C', 'C', 'C', 'C', 'C', 'C', 'C', 'C', 'C', 'C', 'C', 'C', 
           'C', 'C', 'C', 'C', 'C', 'C', 'C', 'C', 'C', 'C', 'C', 'C', 
           'C', 'C', 'C', 'C', 'C', 'C', 'H', 'H', 'H', 'H', 'H', 'H', 
           'H', 'H', 'H', 'H', 'H', 'H', 'H', 'H', 'H', 'H', 'H', 'H', 
           'H', 'H', 'H', 'H', 'H', 'H']

    

for index in N_index:
    species[index] = 'N'

# Convert to PySCF molecule format
mol = gto.Mole()
mol.atom = [[str(species[i]), coord] for i, coord in enumerate(coords)]
mol.basis = 'ccpvtz'
mol.spin = 2
mol.build()

# Perform DFT calculation
mf = dft.RKS(mol)
mf.xc = 'pbe0'

mol_eq = optimize(mf,maxsteps=200)

mf_eq = dft.RKS(mol_eq)
mf_eq.xc = 'pbe0'
energy = mf_eq.kernel()


mf_eq.analyze()
mo_energies = mf_eq.mo_energy.tolist()
mulliken_charges = mf_eq.mulliken_pop()[1].tolist()
dipole_moment = mf_eq.dip_moment().tolist()

# Save results to a JSON file
results = {
    "energy": energy,
    "MO_energies": mo_energies,
    "Mulliken_charges": mulliken_charges,
    "dipole_moment": dipole_moment
}

with open("graphene_mol_r_6_6_h_{}.json".format(structure_n), "w") as json_file:
    json.dump(results, json_file, indent=4)

atom_coords = mol_eq.atom_coords()
atom_charges = mol_eq.atom_charges()
num_atoms = len(atom_coords)

with open('graphene_mol_r_6_6_h_{}.xyz'.format(structure_n), 'w') as f:
    f.write(f"{num_atoms}\n")
    f.write("Optimized geometry\n")
    for i in range(num_atoms):
        symbol = gto.mole._symbol(atom_charges[i])
        x, y, z = atom_coords[i]
        f.write(f"{symbol} {x:.6f} {y:.6f} {z:.6f}\n")

num_alpha = mol_eq.nelectron // 2 + mol_eq.spin // 2
num_beta = mol_eq.nelectron // 2 - mol_eq.spin // 2

print(f"Number of alpha electrons: {num_alpha}")
print(f"Number of beta electrons: {num_beta}")

# Spin multiplicity
multiplicity = mol_eq.spin + 1
print(f"Spin multiplicity: {multiplicity}")

###### capture the output ##########
sys.stdout = old_stdout
log_file.close()
###### capture the output ##########
